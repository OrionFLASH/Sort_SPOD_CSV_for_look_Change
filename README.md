# Программа сортировки CSV файлов

<!-- 
Этот файл содержит полную документацию по программе сортировки CSV файлов.
Включает описание, установку, настройку, использование и примеры.

Структура документации:
1. Описание и возможности
2. Установка и настройка
3. Использование и примеры
4. Технические детали
5. Устранение неполадок
-->

## Описание

Программа `main.py` предназначена для сортировки CSV файлов по заданным полям с сохранением исходного форматирования. Основная особенность - обеспечение одинаковой сортировки для двух файлов по одинаковым полям, при этом новые или удаленные поля не влияют на сортировку.

## Основные возможности

- **Автоматическое определение типов полей**: текст, число, дата
- **Сортировка по нескольким полям** с заданным порядком
- **Сохранение исходного форматирования** CSV файлов
- **Логирование операций** на двух уровнях (INFO и DEBUG)
- **Обработка общих полей** между файлами
- **Гибкая настройка параметров** сортировки

## Структура проекта

```
Sort_SPOD_CSV_for_look_Change/
├── main.py              # Основная программа (все в одном файле)
├── requirements.txt     # Зависимости Python
└── README.md           # Документация
```

## Требования

- Python 3.7+
- Модули: pandas, python-dateutil

## Установка и настройка

### 1. Создание виртуального окружения

```bash
# Создаем виртуальное окружение
python3 -m venv venv

# Активируем окружение
source venv/bin/activate  # macOS/Linux
# или
venv\Scripts\activate     # Windows
```

### 2. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 3. Настройка конфигурации

Отредактируйте параметры в начале файла `main.py` в секции "КОНФИГУРАЦИЯ ПРОГРАММЫ":

```python
# Базовые пути
BASE_PATH = '/Users/orionflash/Desktop/MyProject/SORT_CSV_SPOD/WORK'
INPUT_SUBFOLDER = 'INPUT'
OUTPUT_SUBFOLDER = 'OUTPUT'
LOGS_SUBFOLDER = 'LOGS'

# Настройки логирования
LOG_FILENAME = 'csv_sorter'

# Имена входных файлов (без расширения .csv)
INPUT_FILES = ['file1', 'file2']

# Настройки сортировки
SORT_CONFIG = {
    'delimiter': ',',  # Разделитель CSV файла
    'fields': [
        {
            'name': 'department',      # Имя поля для сортировки
            'type': 'text',            # Тип поля: 'auto', 'text', 'number', 'date'
            'order': 'asc'             # Порядок сортировки: 'asc' (возрастание), 'desc' (убывание)
        },
        {
            'name': 'salary',          # Имя поля для сортировки
            'type': 'number',          # Тип поля: 'auto', 'text', 'number', 'date'
            'order': 'desc'            # Порядок сортировки: 'asc' (возрастание), 'desc' (убывание)
        },
        {
            'name': 'hire_date',       # Имя поля для сортировки
            'type': 'date',            # Тип поля: 'auto', 'text', 'number', 'date'
            'order': 'asc'             # Порядок сортировки: 'asc' (возрастание), 'desc' (убывание)
        }
    ],
    'order': 'asc'  # Общий порядок сортировки
}
```

## Использование

### Запуск программы

```bash
python main.py
```

### Структура рабочих папок

После запуска программа создаст следующую структуру:

```
WORK/
├── INPUT/           # Входные CSV файлы
│   ├── file1.csv
│   └── file2.csv
├── OUTPUT/          # Отсортированные файлы
│   ├── file1_SORT.csv
│   └── file2_SORT.csv
└── LOGS/            # Файлы логов
    └── csv_sorter.log
```

## Конфигурация сортировки

### Типы полей

- **`auto`** - автоматическое определение типа
- **`text`** - текстовое поле (сортировка по алфавиту)
- **`number`** - числовое поле (сортировка по значению)
- **`date`** - поле даты (сортировка по времени)

### Порядок сортировки

- **`asc`** - по возрастанию (A→Z, 1→9, старые→новые)
- **`desc`** - по убыванию (Z→A, 9→1, новые→старые)

### Примеры конфигураций

#### Сортировка по одному числовому полю

```python
'sort_config': {
    'delimiter': ',',
    'fields': [
        {
            'name': 'price',
            'type': 'number',
            'order': 'desc'
        }
    ],
    'order': 'desc'
}
```

#### Сортировка по нескольким полям

```python
'sort_config': {
    'delimiter': ';',
    'fields': [
        {
            'name': 'department',
            'type': 'text',
            'order': 'asc'
        },
        {
            'name': 'salary',
            'type': 'number',
            'order': 'desc'
        },
        {
            'name': 'hire_date',
            'type': 'date',
            'order': 'asc'
        }
    ],
    'order': 'asc'
}
```

## Логирование

Программа ведет подробные логи в двух режимах:

- **INFO** - основная информация (выводится в консоль)
- **DEBUG** - детальная отладочная информация (только в файл)

Логи сохраняются в файл `LOGS/csv_sorter.log` с временными метками.

## Алгоритм работы

1. **Инициализация**: создание папок, настройка логирования
2. **Анализ файлов**: чтение заголовков, определение общих полей
3. **Определение типов**: автоматическое определение типов полей
4. **Сортировка**: сортировка данных по заданным критериям
5. **Сохранение**: запись отсортированных файлов с суффиксом `_SORT`

## Особенности

- **Сохранение форматирования**: программа не изменяет экранирование, кавычки и другие элементы CSV
- **Обработка общих полей**: сортировка происходит только по полям, присутствующим в обоих файлах
- **Автоопределение типов**: программа автоматически определяет тип поля на основе содержимого
- **Обработка ошибок**: подробное логирование ошибок с возможностью продолжения работы

## Примеры использования

### Пример 1: Сортировка по цене

```python
'fields': [
    {
        'name': 'price',
        'type': 'number',
        'order': 'desc'
    }
]
```

### Пример 2: Сортировка по дате и имени

```python
'fields': [
    {
        'name': 'date',
        'type': 'date',
        'order': 'desc'
    },
    {
        'name': 'name',
        'type': 'text',
        'order': 'asc'
    }
]
```

## Устранение неполадок

### Ошибка "Нет общих полей для сортировки"

- Проверьте, что имена полей в конфигурации точно совпадают с заголовками CSV файлов
- Убедитесь, что CSV файлы имеют одинаковую структуру заголовков

### Ошибка чтения файла

- Проверьте правильность пути к файлам
- Убедитесь, что файлы имеют расширение `.csv`
- Проверьте права доступа к файлам

### Проблемы с кодировкой

- Программа использует UTF-8 кодировку
- Убедитесь, что CSV файлы сохранены в правильной кодировке

## Техническая поддержка

При возникновении проблем:

1. Проверьте файл логов `LOGS/csv_sorter.log`
2. Убедитесь в корректности конфигурации
3. Проверьте структуру входных CSV файлов

## Лицензия

Программа распространяется свободно для использования в образовательных и коммерческих целях.
